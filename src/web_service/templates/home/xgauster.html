{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
    <div class="content">
        <div id="dbord" class="row">
            {% for tp in title %}
            <div class="col-lg-6">
                <div class="card card-chart" style="height: 120px;">
                    <div class="card-header">
                        <h5 class="card-category">{{tp.name}}</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-area">
                            <canvas id="{{tp.id}}" class="tp"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
    $(document).ready(function () {
        var canv = document.getElementById('dbord')
        const url = window.location.href
        const queryString = window.location.search;
        let id_exg = url.split('/').pop().split('?')[0];
        // console.log(id_exg);
        if(queryString){
            const urlParams = new URLSearchParams(queryString);
            var d1 = urlParams.get('b');
            var d2 = urlParams.get('e');
        }else{
            d2 = new Date();
            d1 = new Date();
            d2.setHours(d2.getHours()+3);
        }

        var canv = document.getElementsByClassName('tp')
        // console.log(canv)
        for (let i = 0; i < canv.length; i++) {
            let tp_id = canv[i].getAttribute('id')

            fetch('/xgauster_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;chartset=utf-8'
                },
                body: JSON.stringify({
                    // 'id': id_exg,
                    'tp': tp_id,
                    'd1': d1,
                    'd2': d2
                })
            })
            .then(response => response.json())
            .then(result => {
            console.log(result['m1'])
            new Chart(canv[i], {
            type: 'bubble',
            data: {
                datasets: [{
                    label: ["M1"],
                    borderColor: "rgba(212, 40, 40,1)",
                    data: result['m1'],
                    pointStyle: 'star'
                    }, {
                    label: ["M3"],
                    borderColor: "rgba(255,221,50,1)",
                    data: result['m3'],
                    pointStyle: 'rectRot'
                    }, {
                    label: ["M1train"],
                    borderColor: "rgba(212, 40, 40,0.5)",
                    data: result['m1tr'],
                    pointStyle: 'star',
                    pointBorderWidth: 20
                    }, {
                    label: ["M3train"],
                    borderColor: "rgba(255,221,50,0.5)",
                    data: result['m3tr'],
                    pointStyle: 'rectRot'
                }]
            },
            options: {
                maintainAspectRatio: false,
                legend: {
                    display: false
                },
                scales: {
                    xAxes: [{
                        // type: "time",
                        // time: { 
                        //     unit: 'hour',
                        //     tooltipFormat: 'hA' 
                        // },
                        scaleLabel: {
                            display: true,
                        },
                        gridLines: {
                            display:false
                        }
                    }],
                    yAxes: [{
                        display: false,
                        ticks: {
                            suggestedMin: 0.9,    // minimum will be 0, unless there is a lower value.
                            max: 1.3,
                            // beginAtZero: false
                        },
                        gridLines: {
                            display:false
                        }
                    }]
                }
            }
            });
        });
        }
    });
</script>
{% endblock javascripts %}