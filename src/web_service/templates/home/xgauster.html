{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
    <div class="content">
        <div id="dbord" class="row">
            {% for tp in title %}
            <div class="col-lg-6">
                <div class="card card-chart" style="height: 120px;">
                    <div class="card-header">
                        <h5 class="card-category">{{tp.n}}</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-area">
                            <canvas id="{{tp.t}}" class="tp"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
    $(document).ready(function () {
        var canv = document.getElementById('dbord')
        const url = window.location.href
        const queryString = window.location.search;
        let id_exg = url.split('/').pop().split('?')[0];
        // console.log(id_exg);
        if(queryString){
            const urlParams = new URLSearchParams(queryString);
            var d1 = urlParams.get('b');
            var d2 = urlParams.get('e');
        }else{
            d2 = new Date();
            d1 = new Date();
            d2.setHours(d2.getHours()+3);
        }

        var canv = document.getElementsByClassName('tp')
        // console.log(canv)
        for (let i = 0; i < canv.length; i++) {
            let tp_id = canv[i].getAttribute('id')
            let response = fetch('/xgauster_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;chartset=utf-8'
                },
                body: JSON.stringify({
                    'id': id_exg,
                    'tp': tp_id,
                    'd1': d1,
                    'd2': d2
                })
            });
            console.log(response)
            let res = response.json;
            console.log(res)
            new Chart(canv[i], {
            type: 'bubble',
            data: {
                datasets: [{
                    label: ["M1"],
                    borderColor: "rgba(212, 40, 40,1)",
                    data: [{x:1685271300000,y:0,r:0},{x:1685271600000,y:0,r:0},{x:1685271900000,y:0,r:0},{x:1685272200000,y:0,r:0},{x:1685272500000,y:0,r:0},{x:1685272800000,y:0,r:0},{x:1685273100000,y:0,r:0},{x:1685273400000,y:1,r:10},{x:1685273700000,y:0,r:0},{x:1685274000000,y:0,r:0},{x:1685274300000,y:0,r:0},{x:1685274600000,y:0,r:0},{x:1685274900000,y:0,r:0},{x:1685275200000,y:0,r:0},{x:1685275500000,y:0,r:0},{x:1685275800000,y:0,r:0},{x:1685276100000,y:0,r:0},{x:1685276400000,y:1,r:10},{x:1685276700000,y:0,r:0},{x:1685277000000,y:0,r:0},{x:1685277300000,y:0,r:0},{x:1685277600000,y:0,r:0},{x:1685277900000,y:0,r:0},{x:1685278200000,y:0,r:0},{x:1685278500000,y:0,r:0},{x:1685278800000,y:0,r:0},{x:1685279100000,y:0,r:0},{x:1685279400000,y:0,r:0},{x:1685279700000,y:0,r:0},{x:1685280000000,y:0,r:0},{x:1685280300000,y:0,r:0},{x:1685280600000,y:0,r:0},{x:1685280900000,y:0,r:0},{x:1685281200000,y:0,r:0},{x:1685281500000,y:0,r:0},{x:1685281800000,y:0,r:0},{x:1685282100000,y:0,r:0}],
                    pointStyle: 'star'
                    }, {
                    label: ["M3"],
                    borderColor: "rgba(255,221,50,1)",
                    data: [{x:1685271300000,y:0,r:0},{x:1685271600000,y:1,r:10},{x:1685271900000,y:0,r:0},{x:1685272200000,y:0,r:0},{x:1685272500000,y:0,r:0},{x:1685272800000,y:1,r:10},{x:1685273100000,y:0,r:0},{x:1685273400000,y:0,r:0},{x:1685273700000,y:0,r:0},{x:1685274000000,y:0,r:0},{x:1685274300000,y:0,r:0},{x:1685274600000,y:1,r:10},{x:1685274900000,y:0,r:0},{x:1685275200000,y:0,r:0},{x:1685275500000,y:1,r:10},{x:1685275800000,y:0,r:0},{x:1685276100000,y:1,r:10},{x:1685276400000,y:0,r:0},{x:1685276700000,y:0,r:0},{x:1685277000000,y:1,r:10},{x:1685277300000,y:0,r:0},{x:1685277600000,y:1,r:10},{x:1685277900000,y:1,r:10},{x:1685278200000,y:0,r:0},{x:1685278500000,y:1,r:10},{x:1685278800000,y:1,r:10},{x:1685279100000,y:0,r:0},{x:1685279400000,y:0,r:0},{x:1685279700000,y:0,r:0},{x:1685280000000,y:0,r:0},{x:1685280300000,y:1,r:10},{x:1685280600000,y:0,r:0},{x:1685280900000,y:0,r:0},{x:1685281200000,y:0,r:0},{x:1685281500000,y:1,r:10},{x:1685281800000,y:1,r:10},{x:1685282100000,y:0,r:0}],
                    pointStyle: 'rectRot'
                    }, {
                    label: ["M1train"],
                    borderColor: "rgba(212, 40, 40,0.5)",
                    data: [{x:1685271300000,y:0.0,r:0.0},{x:1685271600000,y:0.0,r:0.0},{x:1685271900000,y:0.0,r:0.0},{x:1685272200000,y:0.0,r:0.0},{x:1685272500000,y:0.0,r:0.0},{x:1685272800000,y:0.0,r:0.0},{x:1685273100000,y:0.0,r:0.0},{x:1685273400000,y:0.0,r:0.0},{x:1685273700000,y:0.0,r:0.0},{x:1685274000000,y:0.0,r:0.0},{x:1685274300000,y:0.0,r:0.0},{x:1685274600000,y:0.0,r:0.0},{x:1685274900000,y:0.0,r:0.0},{x:1685275200000,y:0.0,r:0.0},{x:1685275500000,y:0.0,r:0.0},{x:1685275800000,y:0.0,r:0.0},{x:1685276100000,y:0.0,r:0.0},{x:1685276400000,y:0.0,r:0.0},{x:1685276700000,y:0.0,r:0.0},{x:1685277000000,y:0.0,r:0.0},{x:1685277300000,y:0.0,r:0.0},{x:1685277600000,y:0.0,r:0.0},{x:1685277900000,y:1.2,r:6.0},{x:1685278200000,y:0.0,r:0.0},{x:1685278500000,y:0.0,r:0.0},{x:1685278800000,y:1.2,r:6.0},{x:1685279100000,y:0.0,r:0.0},{x:1685279400000,y:0.0,r:0.0},{x:1685279700000,y:0.0,r:0.0},{x:1685280000000,y:0.0,r:0.0},{x:1685280300000,y:0.0,r:0.0},{x:1685280600000,y:1.2,r:6.0},{x:1685280900000,y:0.0,r:0.0},{x:1685281200000,y:0.0,r:0.0},{x:1685281500000,y:0.0,r:0.0},{x:1685281800000,y:0.0,r:0.0},{x:1685282100000,y:0.0,r:0.0}],
                    pointStyle: 'star'
                    }, {
                    label: ["M3train"],
                    borderColor: "rgba(255,221,50,0.5)",
                    data: [{x:1685271300000,y:1.2,r:6.0},{x:1685271600000,y:1.2,r:6.0},{x:1685271900000,y:1.2,r:6.0},{x:1685272200000,y:1.2,r:6.0},{x:1685272500000,y:0.0,r:0.0},{x:1685272800000,y:0.0,r:0.0},{x:1685273100000,y:0.0,r:0.0},{x:1685273400000,y:1.2,r:6.0},{x:1685273700000,y:0.0,r:0.0},{x:1685274000000,y:0.0,r:0.0},{x:1685274300000,y:0.0,r:0.0},{x:1685274600000,y:0.0,r:0.0},{x:1685274900000,y:1.2,r:6.0},{x:1685275200000,y:1.2,r:6.0},{x:1685275500000,y:0.0,r:0.0},{x:1685275800000,y:1.2,r:6.0},{x:1685276100000,y:0.0,r:0.0},{x:1685276400000,y:0.0,r:0.0},{x:1685276700000,y:0.0,r:0.0},{x:1685277000000,y:0.0,r:0.0},{x:1685277300000,y:0.0,r:0.0},{x:1685277600000,y:0.0,r:0.0},{x:1685277900000,y:0.0,r:0.0},{x:1685278200000,y:0.0,r:0.0},{x:1685278500000,y:0.0,r:0.0},{x:1685278800000,y:1.2,r:6.0},{x:1685279100000,y:0.0,r:0.0},{x:1685279400000,y:0.0,r:0.0},{x:1685279700000,y:1.2,r:6.0},{x:1685280000000,y:1.2,r:6.0},{x:1685280300000,y:0.0,r:0.0},{x:1685280600000,y:0.0,r:0.0},{x:1685280900000,y:0.0,r:0.0},{x:1685281200000,y:1.2,r:6.0},{x:1685281500000,y:0.0,r:0.0},{x:1685281800000,y:0.0,r:0.0},{x:1685282100000,y:0.0,r:0.0}],
                    pointStyle: 'rectRot'
                }]
            },
            options: {
                maintainAspectRatio: false,
                legend: {
                    display: false
                },
                scales: {
                    xAxes: [{
                        // type: "time",
                        // time: { 
                        //     unit: 'hour',
                        //     tooltipFormat: 'hA' 
                        // },
                        scaleLabel: {
                            display: true,
                        },
                        gridLines: {
                            display:false
                        }
                    }],
                    yAxes: [{
                        display: false,
                        ticks: {
                            suggestedMin: 0.9,    // minimum will be 0, unless there is a lower value.
                            max: 1.3,
                            // beginAtZero: false
                        },
                        gridLines: {
                            display:false
                        }
                    }]
                }
            }
            });
        }
        console.log(res);

    });
</script>
{% endblock javascripts %}